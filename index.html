<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" href="style.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="chomsky.js"></script>
<script>
  function onClick() {
    $("#myError").text("");
    $("#outVar").html("");

    var inVar = $("#inVar").val();

    try {

      var outVar2 = JSON.stringify(minimize(strToHier(inVar)), undefined, 2);
      $("#outVar2").text(outVar2);

      if (strMinimize(inVar) === inVar) {
        $("#outVar").text(inVar);
        return;
      }

      while (!(strMinimize(inVar) === inVar)) {
        var outVar = minimize_step(inVar);

        $("#outVar").append(inVar + " -> Rule: (" + outVar[1][outVar[1].length - 1] + ")<br />");
        $("#outVar").append(outVar[0] + "<hr />");

        inVar = outVar[0];
      }
    } catch (err) {
      $("#myError").text(err.message);
    }
  }

  function minimize_step(regex) {
    var param = { loopNo: 1, rulesDone: [] };
    var result = strMinimize(regex, param);
    var lastRuleNo = param.rulesDone.length;

    while (result === regex) {
      param.loopNo += 1;
      param.rulesDone = [];
      result = strMinimize(regex, param);

      if (param.rulesDone.length === 0 ||
        param.rulesDone.length === lastRuleNo)
        break;

      lastRuleNo = param.rulesDone.length;
    }

    return [result, param.rulesDone];
  }
</script>

<input id="inVar" value="(a)(a)aλaλ+λ" type="text" />
<button onclick="onClick()">Click</button>
<p id="myError"></p>
<pre id="outVar"></pre>
<pre id="outVar2"></pre>