<!DOCTYPE html>
<html>

<head>
  <title>Regular Expression Simplifier Minimizer Automata Online</title>
  <meta name="description"
    content="Online Regular Expression simplifier and Minimizer, The Best and most Complete Automata Regex Reducer" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="chomsky.js"></script>
  <script src="http://kpdecker.github.io/jsdiff/diff.js"></script>
  <script>
    function onClick() {
      $("#myError").text("");
      $("#outVar").html("");

      var inVar = $("#inVar").val();

      var minimum = strMinimize(inVar);

      try {
        var counter = 1;
        while (!(minimum === inVar)) {
          var outVar = minimize_step(inVar);

          var source = $('<span>' + inVar + '</span>');
          var result = $('<span>' + outVar[0] + '</span>');

          colorize(source, result);

          // fix (b)) => b) wrong colorize
          while (source.html().split(")<font class=\"emph\">)</font>").length > 1) {
            source.html(source.html().split(")<font class=\"emph\">)</font>").join("<font class=\"emph\">)</font>)"));
          }

          $("#outVar").append("<div class=\"ruleTitle\">" + counter + ") Rule: <span class='rule'>" + outVar[1][outVar[1].length - 1] + "</span></div>");
          $("#outVar").append(source);
          $("#outVar").append("<br />");
          // this line is source with bg white color diff
          $("#outVar").append(source.html().split("emph").join("emphW") + "<br />");
          $("#outVar").append(result);
          $("#outVar").append("<hr />");

          inVar = outVar[0];
          counter++;
        }
      } catch (err) {
        $("#myError").text(err.message);
      }

      $("#outVar").append(minimum);
    }

    function minimize_step(regex) {
      var param = { loopNo: 1, rulesDone: [] };
      var result = strMinimize(regex, param);
      var lastRuleNo = param.rulesDone.length;

      while (result === regex) {
        param.loopNo += 1;
        param.rulesDone = [];
        result = strMinimize(regex, param);

        if (param.rulesDone.length === 0 ||
          param.rulesDone.length === lastRuleNo)
          break;

        lastRuleNo = param.rulesDone.length;
      }

      return [result, param.rulesDone];
    }

    // diff color
    function colorize(source, result) {
      // var source = $("#first");
      // var result = $("#second");
      var sourceText = source.text();
      var resultText = result.text();

      var diff = JsDiff.diffChars(sourceText, resultText);

      colorDiv(source, diff, "removed", "emph");
      colorDiv(result, diff, "added", "emphG");
    }

    function colorDiv(div, parts, type, cssClass) {
      var out = "";
      var shouldBeTrueOrUndefined = type;
      var mustBeUndefined = type === "added" ? "removed" : "added";

      for (var i = 0; i < parts.length; i++) {
        if (parts[i][mustBeUndefined] === undefined) {
          if (parts[i][shouldBeTrueOrUndefined] === undefined) {
            out += parts[i].value;
          } else {
            out += '<font class="' + cssClass + '">' + parts[i].value + '</font>';
          }
        }
      }

      div.html(out);
    }
  </script>
</head>

<body>
  <h1>Regular Expression Simplifier and Minimizer</h1>
  <input id="inVar" value="(a)(a)aλaλ+λ" type="text" />
  <button class="button" onclick="onClick()">Minimize</button>
  <p id="myError"></p>
  <pre id="outVar"></pre>
</body>

</html>